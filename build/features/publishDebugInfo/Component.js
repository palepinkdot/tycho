"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _mobxReact=require("mobx-react"),_propTypes=_interopRequireDefault(require("prop-types")),_react=require("react"),_reactIntl=require("react-intl"),_reactJss=_interopRequireDefault(require("react-jss")),_store=require("./store"),_headline=require("../../components/ui/headline"),_auth=require("../../api/utils/auth"),_Button=_interopRequireDefault(require("../../components/ui/Button")),_index=require("../../components/ui/input/index"),_Modal=_interopRequireDefault(require("../../components/ui/Modal")),_config=require("../../config"),_AppStore=_interopRequireDefault(require("../../stores/AppStore")),_ServicesStore=_interopRequireDefault(require("../../stores/ServicesStore")),_jsxRuntime=require("react/jsx-runtime");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const debug=require("debug")("Ferdi:feature:publishDebugInfo"),messages=(0,_reactIntl.defineMessages)({title:{id:"feature.publishDebugInfo.title",defaultMessage:[{type:0,value:"Publish debug information"}]},info:{id:"feature.publishDebugInfo.info",defaultMessage:[{type:0,value:"Publishing your debug information helps us find issues and errors in Ferdi. By publishing your debug information you accept Ferdi Debugger's privacy policy and terms of service"}]},error:{id:"feature.publishDebugInfo.error",defaultMessage:[{type:0,value:"There was an error while trying to publish the debug information. Please try again later or view the console for more information."}]},privacy:{id:"feature.publishDebugInfo.privacy",defaultMessage:[{type:0,value:"Privacy policy"}]},terms:{id:"feature.publishDebugInfo.terms",defaultMessage:[{type:0,value:"Terms of service"}]},publish:{id:"feature.publishDebugInfo.publish",defaultMessage:[{type:0,value:"Accept and publish"}]},published:{id:"feature.publishDebugInfo.published",defaultMessage:[{type:0,value:"Your debug log was published and is now availible at"}]}}),styles=e=>({modal:{width:"80%",maxWidth:600,background:e.styleTypes.primary.contrast,paddingTop:30},headline:{fontSize:20,marginBottom:20,marginTop:-27},info:{paddingBottom:20},link:{color:`${e.styleTypes.primary.accent} !important`,padding:10,cursor:"pointer"},button:{width:"100%",marginTop:10,cursor:"pointer"}});class PublishDebugLogModal extends _react.Component{constructor(...e){super(...e),this.state={log:null,error:!1,isSendingLog:!1}}close(){_store.state.isModalVisible=!1,this.setState({log:null,error:!1,isSendingLog:!1})}async publishDebugInfo(){debug("debugInfo: starting publish"),this.setState({isSendingLog:!0});const e=JSON.stringify(this.props.stores.app.debugInfo),s=await(0,_auth.sendAuthRequest)(`${_config.DEBUG_API}/create`,{method:"POST",body:JSON.stringify({log:e})},!1);if(debug(`debugInfo: publishing status: ${s.status}`),200===s.status){const e=await s.json();e.id?this.setState({log:e.id}):this.setState({error:!0})}else this.setState({error:!0});debug("debugInfo: finished publishing")}render(){const{isModalVisible:e}=_store.state,{classes:s}=this.props,{log:t,error:i,isSendingLog:r}=this.state,{intl:a}=this.props;return(0,_jsxRuntime.jsxs)(_Modal.default,{isOpen:e,shouldCloseOnOverlayClick:!0,className:`${s.modal} publish-debug`,close:()=>this.close(),children:[(0,_jsxRuntime.jsx)(_headline.H1,{className:s.headline,children:a.formatMessage(messages.title)}),t&&(0,_jsxRuntime.jsxs)(_jsxRuntime.Fragment,{children:[(0,_jsxRuntime.jsx)("p",{className:s.info,children:a.formatMessage(messages.published)}),(0,_jsxRuntime.jsx)(_index.Input,{showLabel:!1,value:`${_config.DEBUG_API}/${t}`,readonly:!0})]}),i&&(0,_jsxRuntime.jsx)("p",{className:s.info,children:a.formatMessage(messages.error)}),!t&&!i&&(0,_jsxRuntime.jsxs)(_jsxRuntime.Fragment,{children:[(0,_jsxRuntime.jsx)("p",{className:s.info,children:a.formatMessage(messages.info)}),(0,_jsxRuntime.jsx)("a",{href:`${_config.DEBUG_API}/privacy.html`,target:"_blank",className:s.link,rel:"noreferrer",children:a.formatMessage(messages.privacy)}),(0,_jsxRuntime.jsx)("a",{href:`${_config.DEBUG_API}/terms.html`,target:"_blank",className:s.link,rel:"noreferrer",children:a.formatMessage(messages.terms)}),(0,_jsxRuntime.jsx)(_Button.default,{type:"button",label:a.formatMessage(messages.publish),className:s.button,onClick:()=>this.publishDebugInfo(),disabled:r})]})]})}}PublishDebugLogModal.propTypes={stores:_propTypes.default.shape({app:_propTypes.default.instanceOf(_AppStore.default).isRequired}).isRequired,actions:_propTypes.default.shape({service:_propTypes.default.instanceOf(_ServicesStore.default).isRequired}).isRequired,classes:_propTypes.default.object.isRequired};var _default=(0,_reactIntl.injectIntl)((0,_reactJss.default)(styles,{injectTheme:!0})((0,_mobxReact.inject)("stores","actions")((0,_mobxReact.observer)(PublishDebugLogModal))));exports.default=_default;