"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _class,_descriptor,_descriptor2,_descriptor3,_react=require("react"),_mobxReact=require("mobx-react"),_propTypes=_interopRequireDefault(require("prop-types")),_mobx=require("mobx"),_WebControls=_interopRequireDefault(require("../components/WebControls")),_ServicesStore=_interopRequireDefault(require("../../../stores/ServicesStore")),_Service=_interopRequireDefault(require("../../../models/Service")),_config=require("../../../config"),_AppStore=_interopRequireDefault(require("../../../stores/AppStore")),_jsxRuntime=require("react/jsx-runtime");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _initializerDefineProperty(e,r,i,t){i&&Object.defineProperty(e,r,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(t):void 0})}function _applyDecoratedDescriptor(e,r,i,t,o){var a={};return Object.keys(t).forEach((function(e){a[e]=t[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce((function(i,t){return t(e,r,i)||i}),a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,r,a),a=null),a}function _initializerWarningHelper(e,r){throw new Error("Decorating class property failed. Please ensure that proposal-class-properties is enabled and runs after the decorators transform.")}const URL_EVENTS=["load-commit","will-navigate","did-navigate","did-navigate-in-page"];let WebControlsScreen=(_class=class extends _react.Component{constructor(...e){super(...e),_initializerDefineProperty(this,"url",_descriptor,this),_initializerDefineProperty(this,"canGoBack",_descriptor2,this),_initializerDefineProperty(this,"canGoForward",_descriptor3,this),this.webview=null,this.autorunDisposer=null}componentDidMount(){const{service:e}=this.props;this.autorunDisposer=(0,_mobx.autorun)((()=>{if(e.isAttached){this.webview=e.webview,this.url=this.webview.getURL();for(const e of URL_EVENTS)this.webview.addEventListener(e,(e=>{e.isMainFrame&&(this.url=e.url,this.canGoBack=this.webview.canGoBack(),this.canGoForward=this.webview.canGoForward())}))}}))}componentWillUnmount(){this.autorunDisposer()}goHome(){this.webview&&this.webview.goToIndex(0)}reload(){this.webview&&this.webview.reload()}goBack(){this.webview&&this.webview.goBack()}goForward(){this.webview&&this.webview.goForward()}navigate(e){if(!this.webview)return;let r=e;try{r=new URL(r).toString()}catch{r=/^((?!-))(xn--)?[\da-z][\d_a-z-]{0,61}[\da-z]{0,1}\.(xn--)?([\da-z\-]{1,61}|[\da-z-]{1,30}\.[a-z]{2,})$/.test(r)?`http://${r}`:_config.SEARCH_ENGINE_URLS[this.settings.app.searchEngine]({searchTerm:r})}this.webview.loadURL(r),this.url=r}openInBrowser(){const{openExternalUrl:e}=this.props.actions.app;this.webview&&e({url:this.url})}render(){return(0,_jsxRuntime.jsx)(_WebControls.default,{goHome:()=>this.goHome(),reload:()=>this.reload(),openInBrowser:()=>this.openInBrowser(),canGoBack:this.canGoBack,goBack:()=>this.goBack(),canGoForward:this.canGoForward,goForward:()=>this.goForward(),navigate:e=>this.navigate(e),url:this.url})}},_descriptor=_applyDecoratedDescriptor(_class.prototype,"url",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_descriptor2=_applyDecoratedDescriptor(_class.prototype,"canGoBack",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_descriptor3=_applyDecoratedDescriptor(_class.prototype,"canGoForward",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_class);var _default=(0,_mobxReact.inject)("stores","actions")((0,_mobxReact.observer)(WebControlsScreen));exports.default=_default,WebControlsScreen.propTypes={service:_propTypes.default.instanceOf(_Service.default).isRequired,stores:_propTypes.default.shape({services:_propTypes.default.instanceOf(_ServicesStore.default).isRequired}).isRequired,actions:_propTypes.default.shape({app:_propTypes.default.instanceOf(_AppStore.default).isRequired,service:_propTypes.default.instanceOf(_ServicesStore.default).isRequired}).isRequired};