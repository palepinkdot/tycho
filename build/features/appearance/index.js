"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),color_1=(0,tslib_1.__importDefault)(require("color")),mobx_1=require("mobx"),config_1=require("../../config"),STYLE_ELEMENT_ID="custom-appearance-style";function createStyleElement(){const n=document.createElement("style");n.id=STYLE_ELEMENT_ID,document.querySelector("head")?.appendChild(n)}function setAppearance(n){const e=document.querySelector(`#${STYLE_ELEMENT_ID}`);e&&(e.innerHTML=n)}function darkenAbsolute(n,e){const t=n.lightness();return n.lightness(t-e)}function generateAccentStyle(n){let e;try{e=(0,color_1.default)(n)}catch{n=config_1.DEFAULT_APP_SETTINGS.accentColor,e=(0,color_1.default)(n)}const t=darkenAbsolute(e,5).hex();return`\n    .theme__dark .app .sidebar .sidebar__button.is-muted,\n    .theme__dark .app .sidebar .sidebar__button.is-active,\n    .sidebar .sidebar__button.is-muted,\n    .sidebar .sidebar__button.is-active,\n    .settings .account .invoices .invoices__action button,\n    .settings-navigation .settings-navigation__link.is-active .badge,\n    a.link,\n    button.link,\n    .auth .welcome .button:hover,\n    .auth .welcome .button__inverted,\n    .franz-form .franz-form__radio.is-selected,\n    .theme__dark .franz-form__button.franz-form__button--inverted,\n    .franz-form__button.franz-form__button--inverted {\n      color: ${n};\n    }\n\n    .settings .settings__header,\n    .settings .settings__close,\n    .settings-navigation .settings-navigation__link.is-active,\n    a.button,\n    button.button,\n    .info-bar,\n    .info-bar.info-bar--primary,\n    .infobox.infobox--primary,\n    .theme__dark .badge.badge--primary,\n    .badge.badge--primary,\n    .content-tabs .content-tabs__tabs .content-tabs__item.is-active,\n    #electron-app-title-bar .toolbar-dropdown:not(.open) > .toolbar-button > button:hover,\n    #electron-app-title-bar .list-item.selected .menu-item,\n    #electron-app-title-bar .list-item.selected:focus .menu-item,\n    .theme__dark .quick-switch .active,\n    .franz-form .franz-form__toggle-wrapper .franz-form__toggle.is-active .franz-form__toggle-button,\n    .theme__dark .franz-form__button,\n    .franz-form__button,\n    .ferdi__fab,\n    .franz-form .franz-form__slider-wrapper .slider::-webkit-slider-thumb,\n    span.loader div > div > div {\n      background: ${n};\n    }\n\n    .settings .settings__header .separator {\n      border-right-color: ${n};\n    }\n\n    .franz-form .franz-form__radio.is-selected, .tab-item.is-active {\n      border-color: ${n};\n    }\n\n    a.button:hover, button.button:hover {\n      background: ${darkenAbsolute(e,10).hex()};\n    }\n\n    .franz-form__button:hover,\n    .franz-form__button.franz-form__button--inverted:hover,\n    .settings .settings__close:hover,\n    .theme__dark .franz-form__button:hover,\n    .theme__dark .franz-form__button.franz-form__button--inverted:hover,\n    .theme__dark .settings .settings__close:hover {\n      background: ${t};\n    }\n\n    .franz-form__button:active,\n    .theme__dark .franz-form__button:active {\n      background: ${t};\n    }\n\n    .settings__close {\n      border-color: ${t}!important;\n    }\n\n    .theme__dark .franz-form__button.franz-form__button--inverted,\n    .franz-form__button.franz-form__button--inverted {\n      background: none;\n      border-color: ${n};\n    }\n\n    .tab-item.is-active {\n      background: ${e.lightness(90).hex()};\n    }\n  `}function generateServiceRibbonWidthStyle(n,e,t,r){const o=Number(n),a=Number(e)-config_1.iconSizeBias;let i=11,s=-5,c=22;switch(o){case 35:i=9,s=25,c=48;break;case 45:i=10,s=21,c=44;break;case 55:default:i=11,s=13,c=37;break;case 80:i=11,s=3,c=27;break;case 90:i=12,s=0,c=25;break;case 100:i=13,s=2,c=25}r||(c=22,s=-5);const _=Math.max(o/2+a,2);return t?`\n    .sidebar {\n      height: ${o}px !important;\n      overflow: hidden !important;\n    }\n    .tab-item {\n      height: ${o-2}px !important;\n      width: ${o+a+s}px !important;\n      min-height: unset;\n      overflow: hidden !important;\n    }\n    .tab-item .tab-item__icon {\n      width: ${_}px !important;\n    }\n    .sidebar__button {\n      font-size: ${o/3}px !important;\n    }\n    .app .app__content {\n      padding-top: ${o+c}px !important;\n    }\n    .workspaces-drawer {\n      margin-top: -${o}px !important;\n    }\n    .darwin .sidebar {\n      height: ${o+c}px !important;\n    }\n    .darwin .sidebar .sidebar__button--workspaces.is-active {\n      height: ${o-c}px !important;\n    }\n    .tab-item .tab-item__label{\n      font-size: ${i}px !important;\n    }\n    .tab-item div{\n      overflow: hidden !important;\n    }\n  `:`\n    .sidebar {\n      width: ${o}px !important;\n    }\n    .tab-item {\n      width: ${o}px !important;\n      height: min-content !important;\n    }\n    .tab-item .tab-item__icon {\n      width: ${_}px !important;\n    }\n    .sidebar__button {\n      font-size: ${o/3}px !important;\n    }\n    .todos__todos-panel--expanded {\n      width: calc(100% - ${300+o}px) !important;\n    }\n  `}function generateShowDragAreaStyle(n){return`\n    .sidebar {\n      padding-top: 0px !important;\n    }\n    .window-draggable {\n      position: initial;\n      background-color: ${n};\n    }\n    #root {\n      /** Remove 22px from app height, otherwise the page will be too high */\n      height: calc(100% - 22px);\n    }\n  `}function generateVerticalStyle(n,e){if(!document.querySelector("#vertical-style")){const n=document.createElement("link");n.id="vertical-style",n.rel="stylesheet",n.type="text/css",n.href="./styles/vertical.css",document.head.append(n)}const t=Number(n);return`\n  .sidebar {\n  ${e?"\n    width: calc(100% - 300px) !important;\n  ":""}\n  }\n\n  .sidebar .sidebar__button {\n    width: ${t}px;\n  }\n\n  .workspaces-drawer {\n    margin-top: -${t-4-23-1}px !important;\n  }\n\n  .todos__todos-panel--expanded {\n    width: calc(100% - 300px) !important;\n  }\n  `}function generateOpenWorkspaceStyle(){return"\n  .app .app__content {\n    width: 100%;\n    transform: translateX(0px);\n  }\n  .sidebar__button--workspaces {\n    display: none;\n  }\n  "}function generateStyle(n){let e="";const{accentColor:t,serviceRibbonWidth:r,iconSize:o,showDragArea:a,useVerticalStyle:i,alwaysShowWorkspaces:s,showServiceName:c}=n;if(t.toLowerCase()!==config_1.DEFAULT_APP_SETTINGS.accentColor.toLowerCase()&&(e+=generateAccentStyle(t)),r===config_1.DEFAULT_APP_SETTINGS.serviceRibbonWidth&&o===config_1.DEFAULT_APP_SETTINGS.iconSize||(e+=generateServiceRibbonWidthStyle(r,o,i,c)),a&&(e+=generateShowDragAreaStyle(t)),i)e+=generateVerticalStyle(r,s);else if(document.querySelector("#vertical-style")){const n=document.querySelector("#vertical-style");n&&n.remove()}return s&&(e+=generateOpenWorkspaceStyle()),e}function updateStyle(n){setAppearance(generateStyle(n))}function initAppearance(n){const{settings:e}=n;createStyleElement(),(0,mobx_1.reaction)((()=>[e.all.app.accentColor,e.all.app.serviceRibbonWidth,e.all.app.iconSize,e.all.app.showDragArea,e.all.app.useVerticalStyle,e.all.app.alwaysShowWorkspaces,e.all.app.showServiceName]),(()=>{updateStyle(e.all.app)}),{fireImmediately:!0})}exports.default=initAppearance;