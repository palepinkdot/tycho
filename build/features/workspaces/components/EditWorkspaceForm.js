"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=require("react"),_propTypes=_interopRequireDefault(require("prop-types")),_mobxReact=require("mobx-react"),_reactIntl=require("react-intl"),_reactRouter=require("react-router"),_reactJss=_interopRequireDefault(require("react-jss")),_index=require("../../../components/ui/infobox/index"),_index2=require("../../../components/ui/input/index"),_index3=require("../../../components/ui/button/index"),_Workspace=_interopRequireDefault(require("../models/Workspace")),_Service=_interopRequireDefault(require("../../../models/Service")),_Form=_interopRequireDefault(require("../../../lib/Form")),_validationHelpers=require("../../../helpers/validation-helpers"),_WorkspaceServiceListItem=_interopRequireDefault(require("./WorkspaceServiceListItem")),_Request=_interopRequireDefault(require("../../../stores/lib/Request")),_config=require("../../../config"),_Toggle=_interopRequireDefault(require("../../../components/ui/Toggle")),_jsxRuntime=require("react/jsx-runtime");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const messages=(0,_reactIntl.defineMessages)({buttonDelete:{id:"settings.workspace.form.buttonDelete",defaultMessage:[{type:0,value:"Delete workspace"}]},buttonSave:{id:"settings.workspace.form.buttonSave",defaultMessage:[{type:0,value:"Save workspace"}]},name:{id:"settings.workspace.form.name",defaultMessage:[{type:0,value:"Name"}]},yourWorkspaces:{id:"settings.workspace.form.yourWorkspaces",defaultMessage:[{type:0,value:"Your workspaces"}]},keepLoaded:{id:"settings.workspace.form.keepLoaded",defaultMessage:[{type:0,value:"Keep this workspace loaded*"}]},keepLoadedInfo:{id:"settings.workspace.form.keepLoadedInfo",defaultMessage:[{type:0,value:'*This option will be overwritten by the global "Keep all workspaces loaded" option.'}]},servicesInWorkspaceHeadline:{id:"settings.workspace.form.servicesInWorkspaceHeadline",defaultMessage:[{type:0,value:"Services in this Workspace"}]},noServicesAdded:{id:"settings.services.noServicesAdded",defaultMessage:[{type:0,value:"Start by adding a service."}]},discoverServices:{id:"settings.services.discoverServices",defaultMessage:[{type:0,value:"Discover services"}]}}),styles={nameInput:{height:"auto"},serviceList:{height:"auto"},keepLoadedInfo:{marginBottom:"2rem !important"}};class EditWorkspaceForm extends _react.Component{constructor(...e){super(...e),this.form=this.prepareWorkspaceForm(this.props.workspace)}componentWillReceiveProps(e){const{workspace:s}=this.props;s.id!==e.workspace.id&&(this.form=this.prepareWorkspaceForm(e.workspace))}prepareWorkspaceForm(e){const{intl:s,updateWorkspaceRequest:t}=this.props;return t.reset(),new _Form.default({fields:{name:{label:s.formatMessage(messages.name),placeholder:s.formatMessage(messages.name),value:e.name,validators:[_validationHelpers.required]},keepLoaded:{label:s.formatMessage(messages.keepLoaded),value:e.services.includes(_config.KEEP_WS_LOADED_USID),default:!1},services:{value:[...e.services]}}})}save(e){this.props.updateWorkspaceRequest.reset(),e.submit({onSuccess:async e=>{const{onSave:s}=this.props;s(e.values())},onError:async()=>{}})}delete(){const{onDelete:e}=this.props;e()}toggleService(e){const s=this.form.$("services"),t=s.value;t.includes(e.id)?t.splice(t.indexOf(e.id),1):t.push(e.id),s.set(t)}render(){const{intl:e}=this.props,{classes:s,workspace:t,services:r,deleteWorkspaceRequest:a,updateWorkspaceRequest:i}=this.props,{form:o}=this,n=o.$("services").value,u=a.isExecuting,c=i.isExecuting;return(0,_jsxRuntime.jsxs)("div",{className:"settings__main",children:[(0,_jsxRuntime.jsxs)("div",{className:"settings__header",children:[(0,_jsxRuntime.jsx)("span",{className:"settings__header-item",children:(0,_jsxRuntime.jsx)(_reactRouter.Link,{to:"/settings/workspaces",children:e.formatMessage(messages.yourWorkspaces)})}),(0,_jsxRuntime.jsx)("span",{className:"separator"}),(0,_jsxRuntime.jsx)("span",{className:"settings__header-item",children:t.name})]}),(0,_jsxRuntime.jsxs)("div",{className:"settings__body",children:[i.error&&(0,_jsxRuntime.jsx)(_index.Infobox,{icon:"alert",type:"danger",children:"Error while saving workspace"}),(0,_jsxRuntime.jsxs)("div",{className:s.nameInput,children:[(0,_jsxRuntime.jsx)(_index2.Input,{...o.$("name").bind()}),(0,_jsxRuntime.jsx)(_Toggle.default,{field:o.$("keepLoaded")}),(0,_jsxRuntime.jsx)("p",{className:`${s.keepLoadedInfo} franz-form__label`,children:e.formatMessage(messages.keepLoadedInfo)})]}),(0,_jsxRuntime.jsx)("h2",{children:e.formatMessage(messages.servicesInWorkspaceHeadline)}),(0,_jsxRuntime.jsx)("div",{className:s.serviceList,children:0===r.length?(0,_jsxRuntime.jsxs)("div",{className:"align-middle settings__empty-state",children:[(0,_jsxRuntime.jsxs)("p",{className:"settings__empty-text",children:[(0,_jsxRuntime.jsx)("span",{className:"emoji",children:(0,_jsxRuntime.jsx)("img",{src:"./assets/images/emoji/sad.png",alt:""})}),e.formatMessage(messages.noServicesAdded)]}),(0,_jsxRuntime.jsx)(_reactRouter.Link,{to:"/settings/recipes",className:"button",children:e.formatMessage(messages.discoverServices)})]}):(0,_jsxRuntime.jsx)(_jsxRuntime.Fragment,{children:r.map((e=>(0,_jsxRuntime.jsx)(_WorkspaceServiceListItem.default,{service:e,isInWorkspace:n.includes(e.id),onToggle:()=>this.toggleService(e)},e.id)))})})]}),(0,_jsxRuntime.jsxs)("div",{className:"settings__controls",children:[(0,_jsxRuntime.jsx)(_index3.Button,{label:e.formatMessage(messages.buttonDelete),loaded:!1,busy:u,buttonType:u?"secondary":"danger",className:"settings__delete-button",disabled:u,onClick:this.delete.bind(this)}),(0,_jsxRuntime.jsx)(_index3.Button,{type:"submit",label:e.formatMessage(messages.buttonSave),busy:c,className:"franz-form__button",buttonType:c?"secondary":"primary",onClick:this.save.bind(this,o),disabled:c})]})]})}}EditWorkspaceForm.propTypes={classes:_propTypes.default.object.isRequired,onDelete:_propTypes.default.func.isRequired,onSave:_propTypes.default.func.isRequired,services:_propTypes.default.arrayOf(_propTypes.default.instanceOf(_Service.default)).isRequired,workspace:_propTypes.default.instanceOf(_Workspace.default).isRequired,updateWorkspaceRequest:_propTypes.default.instanceOf(_Request.default).isRequired,deleteWorkspaceRequest:_propTypes.default.instanceOf(_Request.default).isRequired};var _default=(0,_reactIntl.injectIntl)((0,_reactJss.default)(styles,{injectTheme:!0})((0,_mobxReact.observer)(EditWorkspaceForm)));exports.default=_default;