"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _class,_descriptor,_descriptor2,_descriptor3,_descriptor4,_descriptor5,_class2,_temp,_mobx=require("mobx"),_fp=require("lodash/fp");function _initializerDefineProperty(e,i,r,t){r&&Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(t):void 0})}function _applyDecoratedDescriptor(e,i,r,t,s){var o={};return Object.keys(t).forEach((function(e){o[e]=t[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,t){return t(e,i,r)||r}),o),s&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(s):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,i,o),o=null),o}function _initializerWarningHelper(e,i){throw new Error("Decorating class property failed. Please ensure that proposal-class-properties is enabled and runs after the decorators transform.")}let Request=(_temp=_class2=class e{static registerHook(i){e._hooks.push(i)}constructor(e,i){_initializerDefineProperty(this,"result",_descriptor,this),_initializerDefineProperty(this,"error",_descriptor2,this),_initializerDefineProperty(this,"isExecuting",_descriptor3,this),_initializerDefineProperty(this,"isError",_descriptor4,this),_initializerDefineProperty(this,"wasExecuted",_descriptor5,this),this._promise=Promise,this._api={},this._method="",this._isWaitingForResponse=!1,this._currentApiCall=null,this.retry=()=>this.reload(),this.reset=()=>(this.error=null,this.result=null,this.isExecuting=!1,this.isError=!1,this.wasExecuted=!1,this._isWaitingForResponse=!1,this._promise=Promise,this),this._api=e,this._method=i}execute(...e){if(this._isWaitingForResponse)return this;if(!this._api[this._method])throw new Error(`Missing method <${this._method}> on api object:`,this._api);return setTimeout((0,_mobx.action)((()=>{this.isExecuting=!0})),0),this._promise=new Promise(((i,r)=>{this._api[this._method](...e).then((e=>(setTimeout((0,_mobx.action)((()=>{this.error=null,this.result=e,this._currentApiCall&&(this._currentApiCall.result=e),this.isExecuting=!1,this.isError=!1,this.wasExecuted=!0,this._isWaitingForResponse=!1,this._triggerHooks(),i(e)})),1),e))).catch((0,_mobx.action)((e=>{setTimeout((0,_mobx.action)((()=>{this.error=e,this.isExecuting=!1,this.isError=!0,this.wasExecuted=!0,this._isWaitingForResponse=!1,this._triggerHooks(),r(e)})),1)})))})),this._isWaitingForResponse=!0,this._currentApiCall={args:e,result:null},this}reload(){const e=this._currentApiCall?this._currentApiCall.args:[];return this.error=null,this.execute(...e)}isExecutingWithArgs(...e){return this.isExecuting&&this._currentApiCall&&(0,_fp.isEqual)(this._currentApiCall.args,e)}get isExecutingFirstTime(){return!this.wasExecuted&&this.isExecuting}then(...e){if(!this._promise)throw new Error("You have to call Request::execute before you can access it as promise");return this._promise.then(...e)}catch(...e){if(!this._promise)throw new Error("You have to call Request::execute before you can access it as promise");return this._promise.catch(...e)}_triggerHooks(){for(const i of e._hooks)i(this)}},_class2._hooks=[],_descriptor=_applyDecoratedDescriptor((_class=_temp).prototype,"result",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_descriptor2=_applyDecoratedDescriptor(_class.prototype,"error",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_descriptor3=_applyDecoratedDescriptor(_class.prototype,"isExecuting",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_descriptor4=_applyDecoratedDescriptor(_class.prototype,"isError",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_descriptor5=_applyDecoratedDescriptor(_class.prototype,"wasExecuted",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_applyDecoratedDescriptor(_class.prototype,"isExecutingFirstTime",[_mobx.computed],Object.getOwnPropertyDescriptor(_class.prototype,"isExecutingFirstTime"),_class.prototype),_class);exports.default=Request;