"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _class,_descriptor,_descriptor2,_descriptor3,_mobx=require("mobx"),_Store=_interopRequireDefault(require("./lib/Store")),_Request=_interopRequireDefault(require("./lib/Request"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _initializerDefineProperty(e,r,i,t){i&&Object.defineProperty(e,r,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(t):void 0})}function _applyDecoratedDescriptor(e,r,i,t,o){var s={};return Object.keys(t).forEach((function(e){s[e]=t[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,t){return t(e,r,i)||i}),s),o&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,r,s),s=null),s}function _initializerWarningHelper(e,r){throw new Error("Decorating class property failed. Please ensure that proposal-class-properties is enabled and runs after the decorators transform.")}let GlobalErrorStore=(_class=class extends _Store.default{constructor(...e){super(...e),_initializerDefineProperty(this,"error",_descriptor,this),_initializerDefineProperty(this,"messages",_descriptor2,this),_initializerDefineProperty(this,"response",_descriptor3,this),this._handleRequests=(0,_mobx.action)((async e=>{if(e.isError){if(this.error=e.error,e.error.json){try{this.response=await e.error.json()}catch{this.response={}}401===this.error.status&&(window.ferdi.stores.app.authRequestFailed=!0)}this.messages.push({type:"error",request:{result:e.result,wasExecuted:e.wasExecuted,method:e._method},error:this.error,response:this.response,server:window.ferdi.stores.settings.app.server})}else window.ferdi.stores.app.authRequestFailed=!1})),window.addEventListener("error",((...e)=>{this._handleConsoleError.call(this,["error",...e])}));const r=console.error;window.console.error=(...e)=>{this._handleConsoleError.call(this,["error",...e]),r.apply(this,e)};const i=console.log;window.console.log=(...e)=>{this._handleConsoleError.call(this,["log",...e]),i.apply(this,e)};const t=console.info;window.console.info=(...e)=>{this._handleConsoleError.call(this,["info",...e]),t.apply(this,e)},_Request.default.registerHook(this._handleRequests)}_handleConsoleError(e,r,i,t){"object"==typeof e&&e.length>0?this.messages.push({type:e[0],info:e}):this.messages.push({type:e,error:r,url:i,line:t})}},_descriptor=_applyDecoratedDescriptor(_class.prototype,"error",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_descriptor2=_applyDecoratedDescriptor(_class.prototype,"messages",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_descriptor3=_applyDecoratedDescriptor(_class.prototype,"response",[_mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),_class);exports.default=GlobalErrorStore;