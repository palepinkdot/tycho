"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),mobx_1=require("mobx"),fs_extra_1=require("fs-extra"),environment_remote_1=require("../environment-remote"),debug=require("debug")("Ferdi:Settings");class Settings{constructor(t,e={}){this.type="",this.defaultState=void 0,this.store={},this.type=t,this.store=e,this.defaultState=e,(0,fs_extra_1.pathExistsSync)(this.settingsFile)?this._hydrate():this._writeFile()}set(t){this.store=this._merge(t),this._writeFile()}get all(){return this.store}get allSerialized(){return(0,mobx_1.toJS)(this.store)}get(t){return this.store[t]}_merge(t){return Object.assign(this.defaultState,this.store,t)}_hydrate(){this.store=this._merge((0,fs_extra_1.readJsonSync)(this.settingsFile)),debug("Hydrate store",this.type,this.allSerialized)}_writeFile(){(0,fs_extra_1.outputJsonSync)(this.settingsFile,this.store,{spaces:2}),debug("Write settings file",this.type,this.allSerialized)}get settingsFile(){return(0,environment_remote_1.userDataPath)("config",`${"app"===this.type?"settings":this.type}.json`)}}(0,tslib_1.__decorate)([mobx_1.observable],Settings.prototype,"store",void 0),exports.default=Settings;