"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const electron_1=require("electron"),electron_updater_1=require("electron-updater"),environment_1=require("../../environment"),debug=require("debug")("Ferdi:ipcApi:autoUpdate");exports.default=e=>{const t=Boolean(e.settings.app.get("automaticUpdates"));t?(environment_1.isMac||environment_1.isWindows||process.env.APPIMAGE)&&(electron_1.ipcMain.on("autoUpdate",((a,o)=>{if(t)try{electron_updater_1.autoUpdater.autoInstallOnAppQuit=!1,electron_updater_1.autoUpdater.allowPrerelease=Boolean(e.settings.app.get("beta")),"check"===o.action?(debug("checking for update"),electron_updater_1.autoUpdater.checkForUpdates()):"install"===o.action&&(debug("installing update"),electron_1.app.removeAllListeners("window-all-closed"),e.mainWindow.removeAllListeners("close"),electron_updater_1.autoUpdater.quitAndInstall())}catch(e){a.sender.send("autoUpdate",{error:e})}})),electron_updater_1.autoUpdater.on("update-not-available",(()=>{debug("update-not-available"),e.mainWindow.webContents.send("autoUpdate",{available:!1})})),electron_updater_1.autoUpdater.on("update-available",(a=>{debug("update-available"),t&&e.mainWindow.webContents.send("autoUpdate",{version:a.version,available:!0})})),electron_updater_1.autoUpdater.on("download-progress",(e=>{let t=`Download speed: ${e.bytesPerSecond}`;t=`${t} - Downloaded ${e.percent}%`,t=`${t} (${e.transferred}/${e.total})`,debug(t)})),electron_updater_1.autoUpdater.on("update-downloaded",(()=>{debug("update-downloaded"),e.mainWindow.webContents.send("autoUpdate",{downloaded:!0})})),electron_updater_1.autoUpdater.on("error",(t=>{debug("update-error"),e.mainWindow.webContents.send("autoUpdate",{error:t})}))):(electron_updater_1.autoUpdater.autoInstallOnAppQuit=!1,electron_updater_1.autoUpdater.autoDownload=!1)};