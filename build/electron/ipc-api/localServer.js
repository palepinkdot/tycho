"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const electron_1=require("electron"),net_1=require("net"),config_1=require("../../config"),environment_remote_1=require("../../environment-remote"),start_1=require("../../internal-server/start"),portInUse=e=>new Promise((r=>{const t=(0,net_1.createServer)((e=>{e.write("Echo server\r\n"),e.pipe(e)}));t.listen(e,config_1.LOCAL_HOSTNAME),t.on("error",(()=>{r(!0)})),t.on("listening",(()=>{t.close(),r(!1)}))}));let localServerStarted=!1;exports.default=e=>{electron_1.ipcMain.on("startLocalServer",(()=>{if(!localServerStarted){let r=config_1.LOCAL_PORT;(async()=>{for(;await portInUse(r)&&r<config_1.LOCAL_PORT+10;)r+=1;console.log("Starting local server on port",r),(0,start_1.server)((0,environment_remote_1.userDataPath)(),r),e.mainWindow.webContents.send("localServerPort",{port:r})})(),localServerStarted=!0}}))};