"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _fsExtra=require("fs-extra"),_react=require("react"),_propTypes=_interopRequireDefault(require("prop-types")),_mobx=require("mobx"),_mobxReact=require("mobx-react"),_RecipePreviewsStore=_interopRequireDefault(require("../../stores/RecipePreviewsStore")),_RecipesStore=_interopRequireDefault(require("../../stores/RecipesStore")),_ServicesStore=_interopRequireDefault(require("../../stores/ServicesStore")),_UserStore=_interopRequireDefault(require("../../stores/UserStore")),_RecipesDashboard=_interopRequireDefault(require("../../components/settings/recipes/RecipesDashboard")),_ErrorBoundary=_interopRequireDefault(require("../../components/util/ErrorBoundary")),_config=require("../../config"),_environmentRemote=require("../../environment-remote"),_asarHelpers=require("../../helpers/asar-helpers"),_communityRecipes=require("../../features/communityRecipes"),_RecipePreview=_interopRequireDefault(require("../../models/RecipePreview")),_AppStore=_interopRequireDefault(require("../../stores/AppStore")),_urlHelpers=require("../../helpers/url-helpers"),_jsxRuntime=require("react/jsx-runtime");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class RecipesScreen extends _react.Component{constructor(e){super(e),this.state={needle:null,currentFilter:"featured"},this.autorunDisposer=null,this.customRecipes=[],this.customRecipes=(0,_fsExtra.readJsonSync)((0,_asarHelpers.asarRecipesPath)("all.json"))}componentDidMount(){this.autorunDisposer=(0,_mobx.autorun)((()=>{const{filter:e}=this.props.params,{currentFilter:r}=this.state;"all"===e&&"all"!==r?this.setState({currentFilter:"all"}):"featured"===e&&"featured"!==r?this.setState({currentFilter:"featured"}):"dev"===e&&"dev"!==r&&this.setState({currentFilter:"dev"})}))}componentWillUnmount(){this.props.stores.services.resetStatus(),this.autorunDisposer()}searchRecipes(e){if(""===e)this.resetSearch();else{const{search:r}=this.props.actions.recipePreview;this.setState({needle:e}),r({needle:e})}}_sortByName(e,r){return e.name.toLowerCase()<r.name.toLowerCase()?-1:e.name.toLowerCase()>r.name.toLowerCase()?1:0}prepareRecipes(e){return e.filter(((e,r,s)=>s.map((e=>e.id)).indexOf(e.id)===r)).sort(this._sortByName)}createPreviews(e){return e.map((e=>new _RecipePreview.default(e)))}resetSearch(){this.setState({needle:null})}render(){const{recipePreviews:e,recipes:r,services:s}=this.props.stores,{app:t,service:i}=this.props.actions,{filter:a}=this.props.params;let p;p="all"===a?this.prepareRecipes([...e.all,...this.createPreviews(this.customRecipes)]):"dev"===a?_communityRecipes.communityRecipesStore.communityRecipes:e.featured,p=p.sort(this._sortByName);const o=this.state.needle?this.prepareRecipes([...e.searchResults,...this.createPreviews(this.customRecipes.filter((e=>e.name.toLowerCase().includes(this.state.needle.toLowerCase())||(e.aliases||[]).some((e=>e.toLowerCase().includes(this.state.needle.toLowerCase()))))))]).sort(this._sortByName):p,u=e.all.find((e=>e.id===_config.CUSTOM_WEBSITE_RECIPE_ID)),c=e.featuredRecipePreviewsRequest.isExecuting||e.allRecipePreviewsRequest.isExecuting||r.installRecipeRequest.isExecuting||e.searchRecipePreviewsRequest.isExecuting,n=(0,_environmentRemote.userDataRecipesPath)("dev");return(0,_jsxRuntime.jsx)(_ErrorBoundary.default,{children:(0,_jsxRuntime.jsx)(_RecipesDashboard.default,{recipes:o,customWebsiteRecipe:u,isLoading:c,addedServiceCount:s.all.length,hasLoadedRecipes:e.featuredRecipePreviewsRequest.wasExecuted,showAddServiceInterface:i.showAddServiceInterface,searchRecipes:e=>this.searchRecipes(e),resetSearch:()=>this.resetSearch(),searchNeedle:this.state.needle,serviceStatus:s.actionStatus,recipeFilter:a,recipeDirectory:n,openRecipeDirectory:()=>(0,_urlHelpers.openPath)(n),openDevDocs:()=>t.openExternalUrl({url:_config.FRANZ_DEV_DOCS})})})}}RecipesScreen.propTypes={params:_propTypes.default.shape({filter:_propTypes.default.string})},RecipesScreen.defaultProps={params:{filter:null}},RecipesScreen.propTypes={stores:_propTypes.default.shape({recipePreviews:_propTypes.default.instanceOf(_RecipePreviewsStore.default).isRequired,recipes:_propTypes.default.instanceOf(_RecipesStore.default).isRequired,services:_propTypes.default.instanceOf(_ServicesStore.default).isRequired,user:_propTypes.default.instanceOf(_UserStore.default).isRequired}).isRequired,actions:_propTypes.default.shape({app:_propTypes.default.instanceOf(_AppStore.default).isRequired,service:_propTypes.default.instanceOf(_ServicesStore.default).isRequired,recipePreview:_propTypes.default.shape({search:_propTypes.default.func.isRequired}).isRequired}).isRequired};var _default=(0,_mobxReact.inject)("stores","actions")((0,_mobxReact.observer)(RecipesScreen));exports.default=_default;