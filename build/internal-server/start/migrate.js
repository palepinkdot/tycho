"use strict";const{ferdiVersion:ferdiVersion}=require("../../environment-remote"),Database=use("Database"),User=use("App/Models/User"),migrateLog=e=>{console.log("[36m%s[0m","Ferdi Migration:","[0m",e)};module.exports=async()=>{migrateLog("🧙‍  Running database migration wizard"),await Database.raw("CREATE TABLE IF NOT EXISTS `users` (`id` integer not null primary key autoincrement, `settings` text, `created_at` datetime, `updated_at` datetime);");const e=await User.find(1);let t;if(e?t="string"==typeof e.settings?JSON.parse(e.settings):e.settings:(migrateLog("🎩  Migrating from old Ferdi version as user doesn't exist"),await Database.raw('INSERT INTO  "users" ("id") VALUES (\'1\');')),t&&t.db_version&&t.db_version===ferdiVersion)migrateLog("🔧  Nothing to migrate, already on the newest version");else{const e=t&&t.db_version?t.db_version:"5.4.0-beta.2";migrateLog(`🔮  Migrating table from ${e} to ${ferdiVersion}`),t||(t={}),t.db_version=ferdiVersion;const i=await User.find(1);i.settings=JSON.stringify(t),await i.save()}};