"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const dbus_next_1=require("dbus-next"),environment_1=require("../environment");class DBus{constructor(e){this.bus=null,this.trayIcon=void 0,this.trayIcon=e}start(){if(!environment_1.isLinux||this.bus)return;try{this.bus=(0,dbus_next_1.sessionBus)()}catch{return}this.bus._addMatch("type='signal',sender='org.freedesktop.DBus',interface='org.freedesktop.DBus',path='/org/freedesktop/DBus',member='NameOwnerChanged'");const e=JSON.stringify({path:"/org/freedesktop/DBus",interface:"org.freedesktop.DBus",member:"NameOwnerChanged"});this.bus._signals.on(e,(e=>{const[s,t,r]=e.body;"org.kde.StatusNotifierWatcher"===s&&t!==r&&""!==r&&setTimeout((()=>{this.trayIcon.recreateIfVisible()}),400)}))}stop(){this.bus&&(this.bus.disconnect(),this.bus=null)}}exports.default=DBus;