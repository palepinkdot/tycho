"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Select=void 0;const tslib_1=require("tslib"),jsx_runtime_1=require("react/jsx-runtime"),js_1=require("@mdi/js"),react_1=(0,tslib_1.__importDefault)(require("@mdi/react")),classnames_1=(0,tslib_1.__importDefault)(require("classnames")),react_2=require("react"),react_jss_1=(0,tslib_1.__importDefault)(require("react-jss")),error_1=require("../error"),label_1=require("../label"),wrapper_1=require("../wrapper");let popupTransition="none",toggleTransition="none";window&&window.matchMedia("(prefers-reduced-motion: no-preference)")&&(popupTransition="all 0.3s",toggleTransition="transform 0.3s");const styles=e=>({select:{background:e.selectBackground,border:e.selectBorder,borderRadius:e.borderRadiusSmall,height:e.selectHeight,fontSize:e.uiFontSize,width:"100%",display:"flex",alignItems:"center",textAlign:"left",color:e.selectColor},label:{"& > div":{marginTop:5}},popup:{opacity:0,height:0,overflowX:"scroll",border:e.selectBorder,borderTop:0,transition:popupTransition},open:{opacity:1,height:350,background:e.selectPopupBackground},option:{padding:10,borderBottom:e.selectOptionBorder,color:e.selectOptionColor,"&:hover":{background:e.selectOptionItemHover,color:e.selectOptionItemHoverColor},"&:active":{background:e.selectOptionItemActive,color:e.selectOptionItemActiveColor}},selected:{background:e.selectOptionItemActive,color:e.selectOptionItemActiveColor},toggle:{marginLeft:"auto",fill:e.selectToggleColor,transition:toggleTransition},toggleOpened:{transform:"rotateZ(90deg)"},searchContainer:{display:"flex",background:e.selectSearchBackground,alignItems:"center",paddingLeft:10,color:e.selectColor,"& svg":{fill:e.selectSearchColor}},search:{border:0,width:"100%",fontSize:e.uiFontSize,background:"none",marginLeft:10,padding:[10,0],color:e.selectSearchColor},clearNeedle:{background:"none",border:0},focused:{fontWeight:"bold",background:e.selectOptionItemHover,color:e.selectOptionItemHoverColor},hasError:{borderColor:e.brandDanger},disabled:{opacity:e.selectDisabledOpacity},input:{}});class SelectComponent extends react_2.Component{constructor(...e){super(...e),this.state={open:!1,value:"",needle:"",selected:0,options:null},this.componentRef=(0,react_2.createRef)(),this.inputRef=(0,react_2.createRef)(),this.searchInputRef=(0,react_2.createRef)(),this.scrollContainerRef=(0,react_2.createRef)(),this.activeOptionRef=(0,react_2.createRef)(),this.keyListener=void 0}componentWillReceiveProps(e){e.value&&e.value!==this.props.value&&this.setState({value:e.value})}componentDidUpdate(){const{open:e}=this.state;this.searchInputRef&&this.searchInputRef.current&&e&&this.searchInputRef.current.focus()}componentDidMount(){if(this.inputRef&&this.inputRef.current){const{data:e}=this.props;e&&Object.keys(e).map((t=>this.inputRef.current.dataset[t]=e[t]))}window.addEventListener("keydown",this.arrowKeysHandler.bind(this),!1)}componentWillMount(){const{value:e}=this.props;this.componentRef&&this.componentRef.current&&this.componentRef.current.removeEventListener("keydown",this.keyListener),e&&this.setState({value:e}),this.setFilter()}componentWillUnmount(){window.removeEventListener("keydown",this.arrowKeysHandler.bind(this))}setFilter(e=""){const{options:t}=this.props;let s={};e?Object.keys(t).map((o=>{(o.toLocaleLowerCase().startsWith(e.toLocaleLowerCase())||t[o].toLocaleLowerCase().startsWith(e.toLocaleLowerCase()))&&Object.assign(s,{[`${o}`]:t[o]})})):s=t,this.setState({needle:e,options:s,selected:0})}select(e){this.setState((()=>({value:e,open:!1}))),this.setFilter(),this.props.onChange&&this.props.onChange(e)}arrowKeysHandler(e){const{selected:t,open:s,options:o}=this.state;if(s){if(38!==e.keyCode&&40!==e.keyCode||e.preventDefault(),this.componentRef&&this.componentRef.current&&(38===e.keyCode&&t>0?this.setState((e=>({selected:e.selected-1}))):40===e.keyCode&&t<Object.keys(o).length-1?this.setState((e=>({selected:e.selected+1}))):13===e.keyCode&&this.select(Object.keys(o)[t]),this.activeOptionRef&&this.activeOptionRef.current&&this.scrollContainerRef&&this.scrollContainerRef.current)){const e=this.scrollContainerRef.current.offsetTop,t=this.activeOptionRef.current.offsetTop-e;this.scrollContainerRef.current.scrollTop=t-35}e.keyCode}}render(){const{actionText:e,classes:t,className:s,defaultValue:o,disabled:r,error:i,id:n,inputClassName:a,name:l,label:c,showLabel:d,showSearch:p,onChange:u,required:h}=this.props,{open:m,needle:f,value:_,selected:v,options:g}=this.state;let b="";return b=!_&&o&&g[o]?g[o]:_&&g[_]?g[_]:e,(0,jsx_runtime_1.jsxs)(wrapper_1.Wrapper,{className:s,identifier:"franz-select",children:[(0,jsx_runtime_1.jsxs)(label_1.Label,{title:c,showLabel:d,htmlFor:n,className:t.label,isRequired:h,children:[(0,jsx_runtime_1.jsxs)("div",{className:(0,classnames_1.default)({[`${t.hasError}`]:i,[`${t.disabled}`]:r}),ref:this.componentRef,children:[(0,jsx_runtime_1.jsxs)("button",{type:"button",className:(0,classnames_1.default)({[`${a}`]:a,[`${t.select}`]:!0,[`${t.hasError}`]:i}),onClick:r?()=>{}:()=>this.setState((e=>({open:!e.open}))),children:[b,(0,jsx_runtime_1.jsx)(react_1.default,{path:js_1.mdiArrowRightDropCircleOutline,size:.8,className:(0,classnames_1.default)({[`${t.toggle}`]:!0,[`${t.toggleOpened}`]:m})},void 0)]},void 0),p&&m&&(0,jsx_runtime_1.jsxs)("div",{className:t.searchContainer,children:[(0,jsx_runtime_1.jsx)(react_1.default,{path:js_1.mdiMagnify,size:.8},void 0),(0,jsx_runtime_1.jsx)("input",{type:"text",value:f,onChange:e=>this.setFilter(e.currentTarget.value),placeholder:"Search",className:t.search,ref:this.searchInputRef},void 0),f&&(0,jsx_runtime_1.jsx)("button",{type:"button",className:t.clearNeedle,onClick:()=>this.setFilter(),children:(0,jsx_runtime_1.jsx)(react_1.default,{path:js_1.mdiCloseCircle,size:.7},void 0)},void 0)]},void 0),(0,jsx_runtime_1.jsx)("div",{className:(0,classnames_1.default)({[`${t.popup}`]:!0,[`${t.open}`]:m}),ref:this.scrollContainerRef,children:Object.keys(g).map(((e,s)=>(0,jsx_runtime_1.jsx)("div",{onClick:()=>this.select(e),className:(0,classnames_1.default)({[`${t.option}`]:!0,[`${t.selected}`]:g[e]===b,[`${t.focused}`]:v===s}),onMouseOver:()=>this.setState({selected:s}),ref:v===s?this.activeOptionRef:null,children:g[e]},e)))},void 0)]},void 0),(0,jsx_runtime_1.jsx)("input",{className:t.input,id:n,name:l,type:"hidden",defaultValue:_,onChange:u,disabled:r,ref:this.inputRef},void 0)]},void 0),i&&(0,jsx_runtime_1.jsx)(error_1.Error,{message:i},void 0)]},void 0)}}SelectComponent.defaultProps={onChange:()=>{},showLabel:!0,disabled:!1,error:""},exports.Select=(0,react_jss_1.default)(styles,{injectTheme:!0})(SelectComponent);