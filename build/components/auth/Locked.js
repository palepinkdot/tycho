"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _remote=require("@electron/remote"),_react=require("react"),_propTypes=_interopRequireDefault(require("prop-types")),_mobxReact=require("mobx-react"),_reactIntl=require("react-intl"),_Form=_interopRequireDefault(require("../../lib/Form")),_Input=_interopRequireDefault(require("../ui/Input")),_Button=_interopRequireDefault(require("../ui/Button")),_environment=require("../../environment"),_propTypes2=require("../../prop-types"),_jsxRuntime=require("react/jsx-runtime");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const messages=(0,_reactIntl.defineMessages)({headline:{id:"locked.headline",defaultMessage:[{type:0,value:"Locked"}]},touchId:{id:"locked.touchId",defaultMessage:[{type:0,value:"Unlock with Touch ID"}]},touchIdPrompt:{id:"locked.touchIdPrompt",defaultMessage:[{type:0,value:"unlock via Touch ID"}]},passwordLabel:{id:"locked.password.label",defaultMessage:[{type:0,value:"Password"}]},submitButtonLabel:{id:"locked.submit.label",defaultMessage:[{type:0,value:"Unlock"}]},unlockWithPassword:{id:"locked.unlockWithPassword",defaultMessage:[{type:0,value:"Unlock with Password"}]},invalidCredentials:{id:"locked.invalidCredentials",defaultMessage:[{type:0,value:"Password invalid"}]}});class Locked extends _react.Component{constructor(...e){super(...e),this.form=new _Form.default({fields:{password:{label:this.props.intl.formatMessage(messages.passwordLabel),value:"",type:"password"}}},this.props.intl)}submit(e){e.preventDefault(),this.form.submit({onSuccess:e=>{this.props.onSubmit(e.values())},onError:()=>{}})}touchIdUnlock(){const{intl:e}=this.props;_remote.systemPreferences.promptTouchID(e.formatMessage(messages.touchIdPrompt)).then((()=>{this.props.unlock()}))}render(){const{form:e}=this,{intl:s}=this.props,{isSubmitting:t,error:o,useTouchIdToUnlock:r}=this.props,a=!!_environment.isMac&&(r&&_remote.systemPreferences.canPromptTouchID()),u=a?s.formatMessage(messages.unlockWithPassword):s.formatMessage(messages.submitButtonLabel);return(0,_jsxRuntime.jsx)("div",{className:"auth__container",children:(0,_jsxRuntime.jsxs)("form",{className:"franz-form auth__form",onSubmit:e=>this.submit(e),children:[(0,_jsxRuntime.jsx)("img",{src:"./assets/images/logo.svg",className:"auth__logo",alt:""}),(0,_jsxRuntime.jsx)("h1",{children:s.formatMessage(messages.headline)}),a&&(0,_jsxRuntime.jsxs)(_jsxRuntime.Fragment,{children:[(0,_jsxRuntime.jsx)(_Button.default,{className:"auth__button touchid__button",label:s.formatMessage(messages.touchId),onClick:()=>this.touchIdUnlock(),type:"button"}),(0,_jsxRuntime.jsx)("hr",{className:"locked__or_line"})]}),(0,_jsxRuntime.jsx)(_Input.default,{field:e.$("password"),showPasswordToggle:!0,focus:!0}),"invalid-credentials"===o.code&&(0,_jsxRuntime.jsx)("p",{className:"error-message center",children:s.formatMessage(messages.invalidCredentials)}),t?(0,_jsxRuntime.jsx)(_Button.default,{className:"auth__button is-loading",buttonType:"secondary",label:`${u} ...`,loaded:!1,disabled:!0}):(0,_jsxRuntime.jsx)(_Button.default,{type:"submit",className:"auth__button",label:u})]})})}}Locked.propTypes={onSubmit:_propTypes.default.func.isRequired,unlock:_propTypes.default.func.isRequired,isSubmitting:_propTypes.default.bool.isRequired,useTouchIdToUnlock:_propTypes.default.bool.isRequired,error:_propTypes2.globalError.isRequired};var _default=(0,_reactIntl.injectIntl)((0,_mobxReact.observer)(Locked));exports.default=_default;