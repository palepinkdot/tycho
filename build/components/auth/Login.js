"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=require("react"),_propTypes=_interopRequireDefault(require("prop-types")),_mobxReact=require("mobx-react"),_reactIntl=require("react-intl"),_config=require("../../config"),_environmentRemote=require("../../environment-remote"),_Form=_interopRequireDefault(require("../../lib/Form")),_validationHelpers=require("../../helpers/validation-helpers"),_Input=_interopRequireDefault(require("../ui/Input")),_Button=_interopRequireDefault(require("../ui/Button")),_Link=_interopRequireDefault(require("../ui/Link")),_propTypes2=require("../../prop-types"),_jsxRuntime=require("react/jsx-runtime");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const messages=(0,_reactIntl.defineMessages)({headline:{id:"login.headline",defaultMessage:[{type:0,value:"Sign in"}]},emailLabel:{id:"login.email.label",defaultMessage:[{type:0,value:"Email address"}]},passwordLabel:{id:"login.password.label",defaultMessage:[{type:0,value:"Password"}]},submitButtonLabel:{id:"login.submit.label",defaultMessage:[{type:0,value:"Sign in"}]},invalidCredentials:{id:"login.invalidCredentials",defaultMessage:[{type:0,value:"Email or password not valid"}]},customServerQuestion:{id:"login.customServerQuestion",defaultMessage:[{type:0,value:"Using a Franz account to log in?"}]},customServerSuggestion:{id:"login.customServerSuggestion",defaultMessage:[{type:0,value:"Try importing your Franz account into Ferdi"}]},tokenExpired:{id:"login.tokenExpired",defaultMessage:[{type:0,value:"Your session expired, please login again."}]},serverLogout:{id:"login.serverLogout",defaultMessage:[{type:0,value:"Your session expired, please login again."}]},signupLink:{id:"login.link.signup",defaultMessage:[{type:0,value:"Create a free account"}]},passwordLink:{id:"login.link.password",defaultMessage:[{type:0,value:"Reset password"}]}});class Login extends _react.Component{constructor(...e){super(...e),this.form=new _Form.default({fields:{email:{label:this.props.intl.formatMessage(messages.emailLabel),value:"",validators:[_validationHelpers.required,_validationHelpers.email]},password:{label:this.props.intl.formatMessage(messages.passwordLabel),value:"",validators:[_validationHelpers.required],type:"password"}}},this.props.intl)}submit(e){e.preventDefault(),this.form.submit({onSuccess:e=>{this.props.onSubmit(e.values())},onError:()=>{}})}render(){const{form:e}=this,{intl:s}=this.props,{isSubmitting:t,isTokenExpired:i,isServerLogout:r,signupRoute:a,passwordRoute:o,error:n}=this.props;return(0,_jsxRuntime.jsxs)("div",{className:"auth__container",children:[(0,_jsxRuntime.jsxs)("form",{className:"franz-form auth__form",onSubmit:e=>this.submit(e),children:[(0,_jsxRuntime.jsx)(_Link.default,{to:"/auth/welcome",children:(0,_jsxRuntime.jsx)("img",{src:"./assets/images/logo.svg",className:"auth__logo",alt:""})}),(0,_jsxRuntime.jsx)("h1",{children:s.formatMessage(messages.headline)}),i&&(0,_jsxRuntime.jsx)("p",{className:"error-message center",children:s.formatMessage(messages.tokenExpired)}),r&&(0,_jsxRuntime.jsx)("p",{className:"error-message center",children:s.formatMessage(messages.serverLogout)}),(0,_jsxRuntime.jsx)(_Input.default,{field:e.$("email"),focus:!0}),(0,_jsxRuntime.jsx)(_Input.default,{field:e.$("password"),showPasswordToggle:!0}),"invalid-credentials"===n.code&&(0,_jsxRuntime.jsxs)(_jsxRuntime.Fragment,{children:[(0,_jsxRuntime.jsx)("p",{className:"error-message center",children:s.formatMessage(messages.invalidCredentials)}),window.ferdi.stores.settings.all.app.server!==_config.LIVE_FRANZ_API&&(0,_jsxRuntime.jsxs)("p",{className:"error-message center",children:[s.formatMessage(messages.customServerQuestion)," ",(0,_jsxRuntime.jsx)(_Link.default,{to:`${window.ferdi.stores.settings.all.app.server.replace(_environmentRemote.API_VERSION,"")}/import`,target:"_blank",style:{cursor:"pointer",textDecoration:"underline"},children:s.formatMessage(messages.customServerSuggestion)})]})]}),t?(0,_jsxRuntime.jsx)(_Button.default,{className:"auth__button is-loading",buttonType:"secondary",label:`${s.formatMessage(messages.submitButtonLabel)} ...`,loaded:!1,disabled:!0}):(0,_jsxRuntime.jsx)(_Button.default,{type:"submit",className:"auth__button",label:s.formatMessage(messages.submitButtonLabel)})]}),(0,_jsxRuntime.jsxs)("div",{className:"auth__links",children:[(0,_jsxRuntime.jsx)(_Link.default,{to:a,children:s.formatMessage(messages.signupLink)}),(0,_jsxRuntime.jsx)(_Link.default,{to:o,children:s.formatMessage(messages.passwordLink)})]})]})}}Login.propTypes={onSubmit:_propTypes.default.func.isRequired,isSubmitting:_propTypes.default.bool.isRequired,isTokenExpired:_propTypes.default.bool.isRequired,isServerLogout:_propTypes.default.bool.isRequired,signupRoute:_propTypes.default.string.isRequired,passwordRoute:_propTypes.default.string.isRequired,error:_propTypes2.globalError.isRequired};var _default=(0,_reactIntl.injectIntl)((0,_mobxReact.inject)("actions")((0,_mobxReact.observer)(Login)));exports.default=_default;