"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=require("react"),_propTypes=_interopRequireDefault(require("prop-types")),_mobxReact=require("mobx-react"),_reactIntl=require("react-intl"),_renderer=require("electron-react-titlebar/renderer"),_reactJss=_interopRequireDefault(require("react-jss")),_electron=require("electron"),_js=require("@mdi/js"),_InfoBar=_interopRequireDefault(require("../ui/InfoBar")),_basicAuth=require("../../features/basicAuth"),_quickSwitch=require("../../features/quickSwitch"),_publishDebugInfo=require("../../features/publishDebugInfo"),_ErrorBoundary=_interopRequireDefault(require("../util/ErrorBoundary")),_environment=require("../../environment"),_WorkspaceSwitchingIndicator=_interopRequireDefault(require("../../features/workspaces/components/WorkspaceSwitchingIndicator")),_workspaces=require("../../features/workspaces"),_AppUpdateInfoBar=_interopRequireDefault(require("../AppUpdateInfoBar")),_TodosScreen=_interopRequireDefault(require("../../features/todos/containers/TodosScreen")),_icon=require("../ui/icon"),_LockedScreen=_interopRequireDefault(require("../../containers/auth/LockedScreen")),_jsxRuntime=require("react/jsx-runtime");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const messages=(0,_reactIntl.defineMessages)({servicesUpdated:{id:"infobar.servicesUpdated",defaultMessage:[{type:0,value:"Your services have been updated."}]},buttonReloadServices:{id:"infobar.buttonReloadServices",defaultMessage:[{type:0,value:"Reload services"}]},requiredRequestsFailed:{id:"infobar.requiredRequestsFailed",defaultMessage:[{type:0,value:"Could not load services and user information"}]},authRequestFailed:{id:"infobar.authRequestFailed",defaultMessage:[{type:0,value:"There were errors while trying to perform an authenticated request. Please try logging out and back in if this error persists."}]}});let transition="none";window&&window.matchMedia("(prefers-reduced-motion: no-preference)")&&(transition="transform 0.5s ease");const styles=e=>({appContent:{width:"100%",transition:transition,transform:()=>_workspaces.workspaceStore.isWorkspaceDrawerOpen?"translateX(0)":`translateX(-${e.workspaces.drawer.width}px)`},titleBar:{display:"block",zIndex:1,width:"100%",height:"23px",position:"absolute",top:0}}),toggleFullScreen=()=>{_electron.ipcRenderer.send("window.toolbar-double-clicked")};class AppLayout extends _react.Component{constructor(...e){super(...e),this.state={shouldShowAppUpdateInfoBar:!0,shouldShowServicesUpdatedInfoBar:!0}}render(){const{classes:e,isFullScreen:r,workspacesDrawer:s,sidebar:t,services:a,children:i,showServicesUpdatedInfoBar:o,appUpdateIsDownloaded:n,authRequestFailed:u,installAppUpdate:d,settings:p,showRequiredRequestsError:l,areRequiredRequestsSuccessful:c,retryRequiredRequests:_,areRequiredRequestsLoading:f}=this.props,{intl:q}=this.props,{locked:R,automaticUpdates:m}=p.app;return R?(0,_jsxRuntime.jsx)(_LockedScreen.default,{}):(0,_jsxRuntime.jsx)(_ErrorBoundary.default,{children:(0,_jsxRuntime.jsxs)("div",{className:"app",children:[_environment.isWindows&&!r&&(0,_jsxRuntime.jsx)(_renderer.TitleBar,{menu:window.ferdi.menu.template,icon:"assets/images/logo.svg"}),_environment.isMac&&!r&&(0,_jsxRuntime.jsx)("span",{onDoubleClick:toggleFullScreen,className:e.titleBar}),(0,_jsxRuntime.jsxs)("div",{className:`app__content ${e.appContent}`,children:[s,t,(0,_jsxRuntime.jsxs)("div",{className:"app__service",children:[(0,_jsxRuntime.jsx)(_WorkspaceSwitchingIndicator.default,{}),!c&&l&&(0,_jsxRuntime.jsxs)(_InfoBar.default,{type:"danger",ctaLabel:"Try again",ctaLoading:f,sticky:!0,onClick:_,children:[(0,_jsxRuntime.jsx)(_icon.Icon,{icon:_js.mdiFlash}),q.formatMessage(messages.requiredRequestsFailed)]}),u&&(0,_jsxRuntime.jsxs)(_InfoBar.default,{type:"danger",ctaLabel:"Try again",ctaLoading:f,sticky:!0,onClick:_,children:[(0,_jsxRuntime.jsx)(_icon.Icon,{icon:_js.mdiFlash}),q.formatMessage(messages.authRequestFailed)]}),m&&o&&this.state.shouldShowServicesUpdatedInfoBar&&(0,_jsxRuntime.jsxs)(_InfoBar.default,{type:"primary",ctaLabel:q.formatMessage(messages.buttonReloadServices),onClick:()=>window.location.reload(),onHide:()=>{this.setState({shouldShowServicesUpdatedInfoBar:!1})},children:[(0,_jsxRuntime.jsx)(_icon.Icon,{icon:_js.mdiPowerPlug}),q.formatMessage(messages.servicesUpdated)]}),m&&n&&this.state.shouldShowAppUpdateInfoBar&&(0,_jsxRuntime.jsx)(_AppUpdateInfoBar.default,{onInstallUpdate:d,onHide:()=>{this.setState({shouldShowAppUpdateInfoBar:!1})}}),(0,_jsxRuntime.jsx)(_basicAuth.Component,{}),(0,_jsxRuntime.jsx)(_quickSwitch.Component,{}),(0,_jsxRuntime.jsx)(_publishDebugInfo.Component,{}),a,i]}),(0,_jsxRuntime.jsx)(_TodosScreen.default,{})]})]})})}}AppLayout.propTypes={classes:_propTypes.default.object.isRequired,settings:_propTypes.default.object.isRequired,isFullScreen:_propTypes.default.bool.isRequired,sidebar:_propTypes.default.element.isRequired,workspacesDrawer:_propTypes.default.element.isRequired,services:_propTypes.default.element.isRequired,children:_propTypes.default.element,showServicesUpdatedInfoBar:_propTypes.default.bool.isRequired,appUpdateIsDownloaded:_propTypes.default.bool.isRequired,authRequestFailed:_propTypes.default.bool.isRequired,installAppUpdate:_propTypes.default.func.isRequired,showRequiredRequestsError:_propTypes.default.bool.isRequired,areRequiredRequestsSuccessful:_propTypes.default.bool.isRequired,retryRequiredRequests:_propTypes.default.func.isRequired,areRequiredRequestsLoading:_propTypes.default.bool.isRequired},AppLayout.defaultProps={children:[]};var _default=(0,_reactIntl.injectIntl)((0,_reactJss.default)(styles,{injectTheme:!0})((0,_mobxReact.observer)(AppLayout)));exports.default=_default;